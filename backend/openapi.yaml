openapi: 3.1.0
info:
  title: DACH Automation Marketplace API
  description: REST API for the DACH Automation Marketplace
  version: 1.0.0
  license:
    name: MIT

servers:
  - url: http://localhost:3000
    description: Development server

tags:
  - name: Auth
    description: Authentication
  - name: Services
    description: Service listings
  - name: Experts
    description: Expert profiles
  - name: Categories
    description: Categories
  - name: Projects
    description: Projects
  - name: Messages
    description: Messaging
  - name: Payments
    description: Payments
  - name: Admin
    description: Admin

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    User:
      type: object
      properties:
        id:
          type: string
          format: uuid
        email:
          type: string
        firstName:
          type: string
        lastName:
          type: string
        role:
          type: string
          enum: [client, expert, admin]

    AuthResponse:
      type: object
      properties:
        accessToken:
          type: string
        refreshToken:
          type: string
        user:
          $ref: '#/components/schemas/User'

    Service:
      type: object
      properties:
        id:
          type: string
          format: uuid
        title:
          type: string
        price:
          type: integer

    ExpertProfile:
      type: object
      properties:
        id:
          type: string
          format: uuid
        headline:
          type: string
        hourlyRate:
          type: integer

    Category:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        slug:
          type: string

    Error:
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string

paths:
  /health:
    get:
      summary: Health check
      tags: [Health]
      responses:
        '200':
          description: OK

  /api/v1/auth/register:
    post:
      summary: Register new user
      tags: [Auth]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [email, password, firstName, lastName, role]
              properties:
                email:
                  type: string
                password:
                  type: string
                firstName:
                  type: string
                lastName:
                  type: string
                role:
                  type: string
                  enum: [client, expert]
      responses:
        '200':
          description: Success
        '400':
          description: Validation error
        '409':
          description: Email exists

  /api/v1/auth/login:
    post:
      summary: Login
      tags: [Auth]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [email, password]
              properties:
                email:
                  type: string
                password:
                  type: string
      responses:
        '200':
          description: Success
        '401':
          description: Invalid credentials

  /api/v1/auth/logout:
    post:
      summary: Logout
      tags: [Auth]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Logged out

  /api/v1/auth/refresh:
    post:
      summary: Refresh token
      tags: [Auth]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [refreshToken]
              properties:
                refreshToken:
                  type: string
      responses:
        '200':
          description: New tokens

  /api/v1/auth/me:
    get:
      summary: Get current user
      tags: [Auth]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: User data
        '401':
          description: Unauthorized

  /api/v1/categories:
    get:
      summary: List categories
      tags: [Categories]
      responses:
        '200':
          description: Category list

  /api/v1/categories/{slug}:
    get:
      summary: Get category by slug
      tags: [Categories]
      parameters:
        - name: slug
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Category
        '404':
          description: Not found

  /api/v1/services:
    get:
      summary: List services
      tags: [Services]
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: per_page
          in: query
          schema:
            type: integer
            default: 20
        - name: category
          in: query
          schema:
            type: string
        - name: min_price
          in: query
          schema:
            type: integer
        - name: max_price
          in: query
          schema:
            type: integer
      responses:
        '200':
          description: Service list

    post:
      summary: Create service
      tags: [Services]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [title, description, categoryId, pricingType, price]
              properties:
                title:
                  type: string
                description:
                  type: string
                categoryId:
                  type: string
                pricingType:
                  type: string
                  enum: [fixed, hourly, custom]
                price:
                  type: integer
      responses:
        '201':
          description: Created
        '401':
          description: Unauthorized
        '403':
          description: Not an expert

  /api/v1/services/{id}:
    get:
      summary: Get service
      tags: [Services]
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Service
        '404':
          description: Not found

    put:
      summary: Update service
      tags: [Services]
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Updated
        '401':
          description: Unauthorized
        '403':
          description: Forbidden
        '404':
          description: Not found

    delete:
      summary: Delete service
      tags: [Services]
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '204':
          description: Deleted
        '401':
          description: Unauthorized
        '403':
          description: Forbidden

  /api/v1/experts:
    get:
      summary: List experts
      tags: [Experts]
      parameters:
        - name: page
          in: query
          schema:
            type: integer
        - name: skills
          in: query
          schema:
            type: string
        - name: tools
          in: query
          schema:
            type: string
      responses:
        '200':
          description: Expert list

  /api/v1/experts/{id}:
    get:
      summary: Get expert
      tags: [Experts]
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Expert profile
        '404':
          description: Not found

  /api/v1/experts/profile:
    get:
      summary: Get own expert profile
      tags: [Experts]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Profile
        '401':
          description: Unauthorized

    put:
      summary: Update expert profile
      tags: [Experts]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Updated
        '401':
          description: Unauthorized

  /api/v1/projects:
    get:
      summary: List user projects
      tags: [Projects]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Project list
        '401':
          description: Unauthorized

    post:
      summary: Create project
      tags: [Projects]
      security:
        - bearerAuth: []
      responses:
        '201':
          description: Created
        '401':
          description: Unauthorized

  /api/v1/projects/{id}:
    get:
      summary: Get project
      tags: [Projects]
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Project
        '401':
          description: Unauthorized
        '404':
          description: Not found

  /api/v1/projects/{id}/accept:
    post:
      summary: Accept project (expert)
      tags: [Projects]
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Accepted
        '401':
          description: Unauthorized

  /api/v1/projects/{id}/deliver:
    post:
      summary: Deliver project
      tags: [Projects]
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Delivered
        '401':
          description: Unauthorized

  /api/v1/projects/{id}/complete:
    post:
      summary: Complete project (client)
      tags: [Projects]
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Completed
        '401':
          description: Unauthorized

  /api/v1/messages/conversations:
    get:
      summary: List conversations
      tags: [Messages]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Conversations
        '401':
          description: Unauthorized

  /api/v1/messages/conversations/{id}:
    get:
      summary: Get conversation messages
      tags: [Messages]
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Messages
        '401':
          description: Unauthorized

  /api/v1/messages/send:
    post:
      summary: Send message
      tags: [Messages]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [recipientId, content]
              properties:
                recipientId:
                  type: string
                  format: uuid
                content:
                  type: string
      responses:
        '200':
          description: Sent
        '401':
          description: Unauthorized

  /api/v1/payments/checkout:
    post:
      summary: Create checkout session
      tags: [Payments]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [projectId]
              properties:
                projectId:
                  type: string
                  format: uuid
      responses:
        '200':
          description: Checkout URL
        '401':
          description: Unauthorized

  /api/v1/payments/webhook:
    post:
      summary: Stripe webhook
      tags: [Payments]
      responses:
        '200':
          description: Processed

  /api/v1/admin/users:
    get:
      summary: List users (admin)
      tags: [Admin]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Users
        '401':
          description: Unauthorized
        '403':
          description: Not admin

  /api/v1/admin/experts/pending:
    get:
      summary: List pending experts
      tags: [Admin]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Pending experts
        '403':
          description: Not admin

  /api/v1/admin/experts/{id}/verify:
    post:
      summary: Verify expert
      tags: [Admin]
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Verified
        '403':
          description: Not admin

  /api/v1/admin/analytics:
    get:
      summary: Platform analytics
      tags: [Admin]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Analytics data
        '403':
          description: Not admin
